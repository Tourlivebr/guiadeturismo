---
// Dados dos passeios para busca
const todosPasseios = [
  // Ingressos e Atrações
  {
    id: 1,
    titulo: "Cristais de Gramado",
    subtitulo: "Ingresso",
    categoria: "INGRESSOS E ATRAÇÕES",
    tipo: "ingressos",
    slug: "cristais-de-gramado"
  },
  {
    id: 2,
    titulo: "Grupo Dreams",
    subtitulo: "Passaporte para 7 Atrações",
    categoria: "INGRESSOS E ATRAÇÕES",
    tipo: "ingressos",
    slug: "grupo-dreams"
  },
  {
    id: 3,
    titulo: "Ingresso Selfie Gramado",
    subtitulo: "Cenários Instagramáveis",
    categoria: "INGRESSOS E ATRAÇÕES",
    tipo: "ingressos",
    slug: "selfie-gramado"
  },
  {
    id: 4,
    titulo: "Parque Terra Mágica Florybal",
    subtitulo: "Parque Temático",
    categoria: "INGRESSOS E ATRAÇÕES",
    tipo: "ingressos",
    slug: "terra-magica-florybal"
  },
  // Passeios e Receptivo
  {
    id: 5,
    titulo: "Tour O Quatrilho",
    subtitulo: "Passeio Rural Com Almoço Típico",
    categoria: "PASSEIOS",
    tipo: "passeios",
    slug: "tour-o-quatrilho"
  },
  {
    id: 6,
    titulo: "Tour Trem e Vinho",
    subtitulo: "Com Trem Maria Fumaça e Épopeia",
    categoria: "PASSEIOS",
    tipo: "passeios",
    slug: "tour-trem-vinho"
  },
  {
    id: 7,
    titulo: "Tour Raízes Coloniais",
    subtitulo: "Passeio Rural Com Café Colonial",
    categoria: "PASSEIOS",
    tipo: "passeios",
    slug: "tour-raizes-coloniais"
  },
  {
    id: 8,
    titulo: "Tour Linha Ávila",
    subtitulo: "Passeio Rural com Costelão na Vala tradicional",
    categoria: "PASSEIOS",
    tipo: "passeios",
    slug: "tour-linha-avila"
  },
  {
    id: 9,
    titulo: "Tour Uva e Vinho Vale dos Vinhedos",
    categoria: "PASSEIOS PRIVATIVOS",
    tipo: "passeios",
    slug: "tour-uva-vinho-vale-vinhedos"
  },
  {
    id: 10,
    titulo: "Tour das Hortênsias Gramado e Canela",
    categoria: "PASSEIOS PRIVATIVOS",
    tipo: "passeios",
    slug: "tour-hortensias-gramado-canela"
  },
  {
    id: 11,
    titulo: "Tour dos Parques",
    categoria: "PASSEIOS PRIVATIVOS",
    tipo: "passeios",
    slug: "tour-dos-parques"
  },
  {
    id: 12,
    titulo: "Parque Space Adventure I",
    subtitulo: "Parque Temático",
    categoria: "INGRESSOS E ATRAÇÕES",
    tipo: "ingressos",
    slug: "parque-space-adventure"
  },
  {
    id: 13,
    titulo: "Delícias de Gramado e Canela",
    subtitulo: "Passeio Privativo",
    categoria: "PASSEIOS PRIVATIVOS",
    tipo: "passeios",
    slug: "delicias-gramado-canela"
  },
  {
    id: 14,
    titulo: "Ensaio Fotográfico Gramado e Canela",
    subtitulo: "Passeio Privativo",
    categoria: "PASSEIOS PRIVATIVOS",
    tipo: "passeios",
    slug: "ensaio-fotografico-gramado-canela"
  },
  {
    id: 15,
    titulo: "Tour Colônia Alemã Nova Petrópolis",
    subtitulo: "Passeio Privativo",
    categoria: "PASSEIOS PRIVATIVOS",
    tipo: "passeios",
    slug: "tour-colonia-alema-nova-petropolis"
  }
];
---

<header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-b border-gray-200/20 dark:border-gray-700/20">
  <div class="container mx-auto px-4">
    <nav class="flex items-center justify-between h-20 lg:h-24" aria-label="Navegação principal">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2 group" aria-label="Página inicial">
        <img 
          src="/images/logo uber.png" 
          alt="Guia Filippi" 
          class="h-14 w-auto lg:h-18 transition-transform group-hover:scale-105 object-contain"
          width="120"
          height="40"
        />
      </a>
      
      <!-- Search Bar - Desktop -->
      <div class="hidden lg:flex flex-1 max-w-md mx-8 relative">
        <div class="relative w-full">
          <input 
            type="text" 
            id="search-input"
            placeholder="Buscar passeios..."
            class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
            autocomplete="off"
          />
          <div class="absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
          
          <!-- Search Results Dropdown -->
          <div id="search-results" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-80 overflow-y-auto hidden z-50">
            <!-- Results will be populated by JavaScript -->
          </div>
        </div>
      </div>
      
      <!-- Desktop Menu -->
      <ul class="hidden md:flex items-center space-x-8" role="menubar">
        <li role="none">
          <a 
            href="#quem-sou" 
            class="text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 font-medium transition-colors duration-200 scroll-smooth"
            role="menuitem"
          >
            Quem sou
          </a>
        </li>
        <li role="none" class="relative group">
          <button 
            class="text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 font-medium transition-colors duration-200 flex items-center"
            role="menuitem"
            aria-haspopup="true"
            aria-expanded="false"
          >
            Serviços
            <svg class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <!-- Dropdown Menu -->
          <div class="absolute top-full left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
            <div class="py-2">
              <a href="#ingressos" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-600 transition-colors">
                <div class="font-medium">Ingressos e Atrações</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Gramado e Canela</div>
              </a>
              <a href="#passeios" class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary-600 transition-colors">
                <div class="font-medium">Passeios e Receptivo</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Tours personalizados</div>
              </a>
            </div>
          </div>
        </li>
        <li role="none">
          <a 
            href="#depoimentos" 
            class="text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 font-medium transition-colors duration-200 scroll-smooth"
            role="menuitem"
          >
            Depoimentos
          </a>
        </li>
        <li role="none">
          <a 
            href="#contato" 
            class="text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 font-medium transition-colors duration-200 scroll-smooth"
            role="menuitem"
          >
            Contato
          </a>
        </li>
      </ul>
      
      <!-- Mobile Search Button -->
      <button 
        id="mobile-search-button"
        class="md:hidden lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors mr-2"
        aria-label="Abrir busca"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </button>
      
      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-button"
        class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
        aria-label="Abrir menu de navegação"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </nav>
    
    <!-- Mobile Search Bar -->
    <div id="mobile-search" class="lg:hidden hidden px-4 pb-4">
      <div class="relative">
        <input 
          type="text" 
          id="mobile-search-input"
          placeholder="Buscar passeios..."
          class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
          autocomplete="off"
        />
        <div class="absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
        
        <!-- Mobile Search Results -->
        <div id="mobile-search-results" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto hidden z-50">
          <!-- Results will be populated by JavaScript -->
        </div>
      </div>
    </div>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-200">
      <div class="px-4 py-4 space-y-4">
        <a href="#quem-sou" class="block text-gray-700 hover:text-blue-600 transition-colors font-medium mobile-menu-link">Quem sou</a>
        
        <!-- Mobile Services Dropdown -->
        <div class="space-y-2">
          <button id="mobile-services-toggle" class="flex items-center justify-between w-full text-gray-700 hover:text-blue-600 transition-colors font-medium">
            Serviços
            <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div id="mobile-services-menu" class="hidden pl-4 space-y-2">
            <a href="#ingressos" class="block text-gray-600 hover:text-blue-600 transition-colors mobile-menu-link">Ingressos e Atrações</a>
            <a href="#passeios" class="block text-gray-600 hover:text-blue-600 transition-colors mobile-menu-link">Passeios e Receptivo</a>
          </div>
        </div>
        
        <a href="#depoimentos" class="block text-gray-700 hover:text-blue-600 transition-colors font-medium mobile-menu-link">Depoimentos</a>
        <a href="#contato" class="block text-gray-700 hover:text-blue-600 transition-colors font-medium mobile-menu-link">Contato</a>
      </div>
    </div>
  </div>
</header>

<script define:vars={{ todosPasseios }}>
  // Header scroll behavior
  const header = document.getElementById('header');
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuLinks = document.querySelectorAll('.mobile-menu-link');
  const mobileServicesToggle = document.getElementById('mobile-services-toggle');
  const mobileServicesMenu = document.getElementById('mobile-services-menu');
  const mobileSearchButton = document.getElementById('mobile-search-button');
  const mobileSearch = document.getElementById('mobile-search');
  const searchInput = document.getElementById('search-input');
  const mobileSearchInput = document.getElementById('mobile-search-input');
  const searchResults = document.getElementById('search-results');
  const mobileSearchResults = document.getElementById('mobile-search-results');
  
  let isMenuOpen = false;
  let isServicesOpen = false;
  let isMobileSearchOpen = false;
  
  // Search functionality
  function performSearch(query, resultsContainer) {
    if (!query.trim()) {
      resultsContainer.classList.add('hidden');
      return;
    }
    
    const filteredPasseios = todosPasseios.filter(passeio => 
      passeio.titulo.toLowerCase().includes(query.toLowerCase()) ||
      passeio.subtitulo.toLowerCase().includes(query.toLowerCase())
    );
    
    if (filteredPasseios.length === 0) {
      resultsContainer.innerHTML = `
        <div class="p-4 text-gray-500 text-center">
          Nenhum passeio encontrado
        </div>
      `;
    } else {
      resultsContainer.innerHTML = filteredPasseios.map(passeio => {
        const href = passeio.tipo === 'ingressos' ? `/${passeio.slug}` : `/passeio/${passeio.slug}`;
        return `
          <a href="${href}" class="block p-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0">
            <div class="font-medium text-gray-800">${passeio.titulo}</div>
            <div class="text-sm text-gray-600">${passeio.subtitulo}</div>
            <div class="text-xs text-blue-600 mt-1">${passeio.categoria}</div>
          </a>
        `;
      }).join('');
    }
    
    resultsContainer.classList.remove('hidden');
  }
  
  // Desktop search
  searchInput?.addEventListener('input', (e) => {
    performSearch(e.target.value, searchResults);
  });
  
  // Mobile search
  mobileSearchInput?.addEventListener('input', (e) => {
    performSearch(e.target.value, mobileSearchResults);
  });
  
  // Hide search results when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('#search-input') && !e.target.closest('#search-results')) {
      searchResults?.classList.add('hidden');
    }
    if (!e.target.closest('#mobile-search-input') && !e.target.closest('#mobile-search-results')) {
      mobileSearchResults?.classList.add('hidden');
    }
  });
  
  // Mobile search toggle
  mobileSearchButton?.addEventListener('click', () => {
    isMobileSearchOpen = !isMobileSearchOpen;
    
    if (isMobileSearchOpen) {
      mobileSearch?.classList.remove('hidden');
      mobileSearchInput?.focus();
    } else {
      mobileSearch?.classList.add('hidden');
      mobileSearchResults?.classList.add('hidden');
    }
  });
  
  // Scroll behavior
  window.addEventListener('scroll', () => {
    if (window.scrollY > 0) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  });
  
  // Mobile menu toggle
  mobileMenuButton?.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;
    
    if (isMenuOpen) {
      mobileMenu?.classList.remove('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'true');
    } else {
      mobileMenu?.classList.add('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'false');
      // Reset services menu when closing main menu
      isServicesOpen = false;
      mobileServicesMenu?.classList.add('hidden');
      const arrow = mobileServicesToggle?.querySelector('svg');
      arrow?.classList.remove('rotate-180');
    }
  });
  
  // Mobile services dropdown toggle
  mobileServicesToggle?.addEventListener('click', () => {
    isServicesOpen = !isServicesOpen;
    const arrow = mobileServicesToggle.querySelector('svg');
    
    if (isServicesOpen) {
      mobileServicesMenu?.classList.remove('hidden');
      arrow?.classList.add('rotate-180');
    } else {
      mobileServicesMenu?.classList.add('hidden');
      arrow?.classList.remove('rotate-180');
    }
  });
  
  // Close mobile menu when clicking on links
  mobileMenuLinks.forEach(link => {
    link.addEventListener('click', () => {
      isMenuOpen = false;
      isServicesOpen = false;
      mobileMenu?.classList.add('hidden');
      mobileServicesMenu?.classList.add('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'false');
      const arrow = mobileServicesToggle?.querySelector('svg');
      arrow?.classList.remove('rotate-180');
    });
  });
  
  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      
      const href = this instanceof HTMLElement ? this.getAttribute('href') : null;
      const target = href ? document.querySelector(href) : null;
      
      if (target) {
        const headerElement = document.getElementById('header');
        const headerHeight = headerElement?.offsetHeight || 0;
        const targetPosition = target.offsetTop - headerHeight - 20;
        
        window.scrollTo({
          top: Math.max(0, targetPosition),
          behavior: 'smooth'
        });
        
        // Hide search results after navigation
        searchResults?.classList.add('hidden');
        mobileSearchResults?.classList.add('hidden');
      }
    });
  });
</script>

<style>
  .scrolled {
    @apply h-16 lg:h-20;
  }
</style>